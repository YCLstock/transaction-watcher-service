# Go Ethereum Transaction Watcher Service

[![Go Version](https://img.shields.io/badge/Go-1.25+-blue.svg)](https://go.dev/) [![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

ä¸€å€‹ä½¿ç”¨ **Go èªè¨€**é–‹ç™¼çš„ã€æº–ç”Ÿç”¢ç´šçš„å€å¡Šéˆäº¤æ˜“ç›£è½æœå‹™ã€‚å®ƒåŸºæ–¼ **WebSocket** å¯¦ç¾äº†å°ä»¥å¤ªåŠäº‹ä»¶çš„**å³æ™‚ç™¼å¸ƒ/è¨‚é–± (Pub/Sub)**ï¼Œä¸¦åˆ©ç”¨ **Goroutine** å’Œ **Channel** è™•ç†é«˜ä½µç™¼æ•¸æ“šæµã€‚æœ¬å°ˆæ¡ˆæ—¨åœ¨æ¨¡æ“¬ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ (CEX) ç›£è½ç”¨æˆ¶å……å€¼çš„æ ¸å¿ƒæ¥­å‹™é‚è¼¯ï¼Œä¸¦å…·å‚™**è‡ªå‹•éŒ¯èª¤é‡è©¦**å’Œ**æ–·ç·šé‡é€£**çš„å¥å£¯æ€§ã€‚

## ğŸ›ï¸ æ¶æ§‹ (Architecture)

æœ¬æœå‹™æ¡ç”¨äº†**ç”Ÿç”¢è€…-æ¶ˆè²»è€…æ¨¡å‹**ï¼Œå°‡ã€Œæ¥æ”¶äº‹ä»¶ã€èˆ‡ã€Œè™•ç†äº‹ä»¶ã€è§£è€¦ï¼Œå¯¦ç¾é«˜ä½µç™¼è™•ç†ï¼š

`[ Eth Node ] --(WebSocket)--> [ ä¸» Goroutine (æ¥æ”¶) ] --(Channel)--> [ Worker Goroutines (è™•ç†) ] --(Log)--> [ Console ]`

## âœ¨ ä¸»è¦åŠŸèƒ½ (Key Features)

*   **âš¡ å³æ™‚äº‹ä»¶è¨‚é–±:** åŸºæ–¼ `go-ethereum` å‡½å¼åº«ï¼Œä½¿ç”¨ **WebSocket** çš„ `SubscribeNewHead` æ–¹æ³•ï¼Œå¯¦ç¾å°æ–°å€å¡Šçš„ä½å»¶é²ã€å³æ™‚è¨‚é–±ã€‚
*   **ğŸš€ é«˜ä½µç™¼è™•ç†:** æ¡ç”¨**å·¥äººæ±  (Worker Pool)** æ¨¡å¼ï¼Œåˆ©ç”¨ **Goroutine** ä¸¦è¡Œè™•ç†æ–°å€å¡Šçš„æ•¸æ“šç²å–èˆ‡äº¤æ˜“è§£æï¼Œç¢ºä¿ä¸æœƒé˜»å¡äº‹ä»¶æµã€‚
*   **ğŸ›¡ï¸ é«˜å¯é æ€§è¨­è¨ˆ:** å…§å»ºäº†åŸºæ–¼ `for` è¿´åœˆå’Œ `time.Sleep` çš„**è‡ªå‹•æ–·ç·šé‡é€£**æ©Ÿåˆ¶ï¼Œèƒ½å¤ æ‡‰å°ç¶²è·¯æ³¢å‹•å’Œ RPC ç¯€é»çŸ­æš«æ•…éšœã€‚
*   **ğŸ¯ ç²¾æº–ç›®æ¨™éæ¿¾:** èƒ½å¤ åœ¨å€å¡Šçš„æ‰€æœ‰äº¤æ˜“ä¸­ï¼Œé«˜æ•ˆç¯©é¸å‡ºç™¼é€åˆ°**æŒ‡å®šç›£æ§åœ°å€**çš„äº¤æ˜“ã€‚
*   **ğŸ“ å°ˆæ¥­çµæ§‹åŒ–æ—¥èªŒ:** å¼•å…¥ **Logrus** å‡½å¼åº«ï¼Œæ‰€æœ‰è¼¸å‡ºå‡ç‚ºçµæ§‹åŒ–çš„ JSON æ ¼å¼æ—¥èªŒï¼Œä¸¦åŒ…å« `Info`, `Warn`, `Error` ç­‰ä¸åŒç´šåˆ¥ï¼Œä¾¿æ–¼æ—¥èªŒçš„æ”¶é›†èˆ‡åˆ†æã€‚
*   **âš™ï¸ ç’°å¢ƒè®Šæ•¸é…ç½®:** ä½¿ç”¨ `.env` æª”æ¡ˆç®¡ç†æ•æ„Ÿé…ç½®ï¼ˆå¦‚ API Keyï¼‰ï¼Œç„¡éœ€ä¿®æ”¹åŸå§‹ç¢¼ã€‚

## ğŸš€ å¿«é€Ÿé–‹å§‹ (Getting Started)

1.  **è¤‡è£½æœ¬å°ˆæ¡ˆ**
    ```bash
    git clone https://github.com/your-username/go-ethereum-watcher.git
    cd go-ethereum-watcher
    ```
2.  **å®‰è£ä¾è³´**
    ```bash
    go mod tidy
    ```
3.  **é…ç½®ç’°å¢ƒè®Šæ•¸**
    *   å°‡ `.env.example` æª”æ¡ˆè¤‡è£½ç‚º `.env`ã€‚
    *   æ‰“é–‹ `.env` æª”æ¡ˆï¼Œå°‡ `ALCHEMY_WSS_URL` çš„å€¼æ›¿æ›ç‚ºæ‚¨è‡ªå·±çš„ Ethereum WebSocket RPC URLã€‚
    ```env
    # .env
    ALCHEMY_WSS_URL="wss://eth-sepolia.g.alchemy.com/v2/YOUR_API_KEY"
    ```
4.  **é‹è¡Œæœå‹™**
    ```bash
    go run main.go
    ```

## ğŸ” æ ¸å¿ƒä»£ç¢¼è§£æ

### `main()` å‡½å¼

`main` å‡½å¼æ˜¯æœå‹™çš„å…¥å£é»å’Œã€Œå®ˆè­·è€…ã€ã€‚å®ƒä½¿ç”¨ä¸€å€‹ç„¡é™ `for` è¿´åœˆä¾†ç¢ºä¿ `startWatching` å‡½å¼åœ¨å› ä»»ä½•éŒ¯èª¤é€€å‡ºå¾Œï¼Œéƒ½èƒ½åœ¨çŸ­æš«å»¶é²å¾Œè‡ªå‹•é‡å•Ÿï¼Œå¯¦ç¾äº†æœå‹™çš„å¥å£¯æ€§ã€‚

```go
func main() {
    godotenv.Load() // è¼‰å…¥ .env
    for {
        startWatching() // å•Ÿå‹•æ ¸å¿ƒç›£è½é‚è¼¯
        logrus.Warn("ç›£è½å™¨å·²åœæ­¢ï¼Œå°‡åœ¨ 15 ç§’å¾Œå˜—è©¦é‡å•Ÿ...")
        time.Sleep(15 * time.Second) // ç™¼ç”ŸéŒ¯èª¤ï¼Œç­‰å¾…å¾Œé‡è©¦
    }
}
```

### `startWatching()` å‡½å¼ - ç”Ÿç”¢è€…èˆ‡æ¶ˆè²»è€…

`startWatching` å‡½å¼æ˜¯æˆ‘å€‘çš„æ ¸å¿ƒæ¥­å‹™é‚è¼¯ï¼Œå®ƒå¯¦ç¾äº†**ç”Ÿç”¢è€…-æ¶ˆè²»è€…æ¨¡å‹**ï¼š

1.  **å»ºç«‹é€£ç·šèˆ‡è¨‚é–± (Setup):**
    *   ä½¿ç”¨ `ethclient.Dial()` å»ºç«‹ WebSocket é€£ç·šã€‚
    *   ä½¿ç”¨ `client.SubscribeNewHead()` è¨‚é–±æ–°å€å¡Šäº‹ä»¶ï¼Œç²å¾—ä¸€å€‹æ¥æ”¶æ–°å€å¡Šé ­çš„ Channel (`headers`)ã€‚

2.  **å»ºç«‹å·¥äººæ±  (Consumers):**
    *   å‰µå»ºä¸€å€‹å¸¶ç·©è¡çš„ Channel `processQueue`ï¼Œä½œç‚ºä»»å‹™éšŠåˆ—ã€‚
    *   å•Ÿå‹•å›ºå®šæ•¸é‡çš„ Goroutineï¼ˆå·¥äººï¼‰ï¼Œå®ƒå€‘éƒ½é˜»å¡å¼åœ°ç­‰å¾…å¾ `processQueue` ç²å–ä»»å‹™ã€‚
    *   æ¯å€‹å·¥äººçš„å·¥ä½œæ˜¯ï¼šç²å–å€å¡Šé ­ -> å‘¼å« `BlockByHash` ç²å–å®Œæ•´å€å¡Š -> éæ­·äº¤æ˜“ä¸¦éæ¿¾ã€‚

    ```go
    processQueue := make(chan *types.Header, 100)

    for i := 1; i <= numWorkers; i++ {
        go func(workerID int) {
            for header := range processQueue {
                // ... è™•ç†å€å¡Šçš„è€—æ™‚æ“ä½œ ...
            }
        }(i)
    }
    ```

3.  **ä¸»äº‹ä»¶è¿´åœˆ (Producer):**
    *   `for-select` è¿´åœˆç¾åœ¨è®Šå¾—éå¸¸è¼•é‡ã€‚å®ƒçš„å”¯ä¸€è·è²¬æ˜¯ç›£è½å…©å€‹ Channelï¼š
        *   `<-sub.Err()`: å¦‚æœè¨‚é–±å‡ºéŒ¯ï¼Œé—œé–‰ `processQueue` ä»¥é€šçŸ¥æ‰€æœ‰å·¥äººåœæ­¢å·¥ä½œï¼Œç„¶å¾Œ `return`ï¼Œè§¸ç™¼ `main` å‡½å¼çš„é‡é€£æ©Ÿåˆ¶ã€‚
        *   `<-headers`: ç•¶æ–°å€å¡Šåˆ°é”æ™‚ï¼Œ**ç«‹å³**å°‡å…¶ç™¼é€åˆ° `processQueue` ä»»å‹™éšŠåˆ—ï¼Œç„¶å¾Œç¹¼çºŒç­‰å¾…ä¸‹ä¸€å€‹äº‹ä»¶ï¼Œ**å®Œå…¨ä¸æœƒè¢«å€å¡Šè™•ç†çš„éç¨‹é˜»å¡**ã€‚

    ```go
    for {
        select {
        case err := <-sub.Err():
            close(processQueue) // é—œé–‰éšŠåˆ—ï¼Œè®“å·¥äººé€€å‡º
            return
        case header := <-headers:
            processQueue <- header // å°‡ä»»å‹™ç™¼é€çµ¦å·¥äºº
        }
    }
    ```